package com.rover\n\nimport android.Manifest\nimport android.content.pm.PackageManager\nimport android.os.Build\nimport android.os.Bundle\nimport androidx.activity.ComponentActivity\nimport androidx.activity.compose.setContent\nimport androidx.activity.result.contract.ActivityResultContracts\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.core.content.ContextCompat\nimport com.rover.ui.screens.ConnectScreen\nimport com.rover.ui.screens.ControlScreen\nimport com.rover.ui.theme.RoverTheme\nimport dagger.hilt.android.AndroidEntryPoint\nimport timber.log.Timber\n\n@AndroidEntryPoint\nclass MainActivity : ComponentActivity() {\n    private val permissionsToRequest = mutableListOf<String>()\n    \n    private val requestPermissionsLauncher = registerForActivityResult(\n        ActivityResultContracts.RequestMultiplePermissions()\n    ) { permissions ->\n        permissions.forEach { (permission, granted) ->\n            if (granted) {\n                Timber.d(\"Permission granted: $permission\")\n            } else {\n                Timber.w(\"Permission denied: $permission\")\n            }\n        }\n    }\n    \n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        \n        // Initialize Timber logging\n        if (BuildConfig.DEBUG) {\n            Timber.plant(Timber.DebugTree())\n        }\n        \n        // Request permissions\n        requestRequiredPermissions()\n        \n        setContent {\n            RoverTheme {\n                RoverApp()\n            }\n        }\n    }\n    \n    private fun requestRequiredPermissions() {\n        val permissions = listOf(\n            Manifest.permission.CAMERA,\n            Manifest.permission.RECORD_AUDIO,\n            Manifest.permission.INTERNET,\n            Manifest.permission.ACCESS_NETWORK_STATE\n        )\n        \n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\n            permissions.forEach { permission ->\n                if (ContextCompat.checkSelfPermission(\n                        this,\n                        permission\n                    ) != PackageManager.PERMISSION_GRANTED\n                ) {\n                    permissionsToRequest.add(permission)\n                }\n            }\n        }\n        \n        if (permissionsToRequest.isNotEmpty()) {\n            requestPermissionsLauncher.launch(permissionsToRequest.toTypedArray())\n        }\n    }\n}\n\n@Composable\nfun RoverApp() {\n    var isConnected by remember { mutableStateOf(false) }\n    var roverAddress by remember { mutableStateOf(\"\") }\n    \n    Surface(\n        modifier = Modifier.fillMaxSize(),\n        color = MaterialTheme.colorScheme.background\n    ) {\n        if (isConnected) {\n            ControlScreen(\n                roverAddress = roverAddress,\n                onDisconnect = {\n                    isConnected = false\n                    roverAddress = \"\"\n                }\n            )\n        } else {\n            ConnectScreen(\n                onConnect = { address ->\n                    roverAddress = address\n                    isConnected = true\n                }\n            )\n        }\n    }\n}\n
